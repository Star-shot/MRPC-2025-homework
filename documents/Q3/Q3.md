## 题目3：无人机微分平坦性（Optional）

## 题目背景

在四旋翼无人机的控制中，微分平坦性是一个重要特性。它指出，系统状态和输入可以通过一组特定的平坦输出及其有限阶导数来代数表示。对于四旋翼，平坦输出通常选择为质心的位置 $(x, y, z)$和偏航角 $\psi$ 。

本题中，无人机的轨迹已在世界坐标系中给定，且规定偏航角 $\psi$ 始终与速度方向对齐。你的任务是利用微分平坦性（不考虑空气阻力），推导并计算出无人机在整个飞行过程中的姿态。

无人机轨迹为水平面内的双纽线（世界坐标系下）：

$$
\left\{\begin{array}{l}
x=\frac{10 \cos t}{1+\sin ^{2} t} \\
y=\frac{10 \sin t \cos t}{1+\sin ^{2} t} \\
z=10
\end{array}\right.
$$

其中，$t \in[0,2 \pi)$ ，时间单位为秒。机体坐标系（Body Frame）定义：

- × 轴：指向无人机前方（Front）
- y 轴：指向无人机左侧（Left）
- z 轴：指向无人机上方（Up）

这是一个＂前－左－上＂（FLU）的坐标系。

## 任务要求

## 1．姿态推导过程：

－根据四旋翼的微分平坦性理论，由给定的位置轨迹 $[x(t), y(t), z(t)]$ 和偏航角 $\psi$ ，推导出无人机机体坐标系各轴在世界坐标系中的方向向量。
－根据这些方向向量，构造世界系到机体系的旋转矩阵，并将其转换为四元数形式。

## 2．编程实现：

－在所提供的虚拟机 ROS 环境中，在 code/src 的工作空间下，创建一个新的 ROS Package，命名为 quadrotor_df，在其中进行相关代码编写。

- 使用 C＋＋及 Eigen 库进行所有必要的向量和矩阵运算。
- 对时间 $t$ 在区间 $[0,2 \pi)$ 内以合适的步长（如 0.02 秒）进行离散采样，计算每个时刻对应的姿态四元数。


## 3．输出文件：

- 将计算结果保存为 df_quaternion．csv 文件。
- 根据df_quaternion．csv 的结果绘制出四元数的变化曲线并且贴到报告中。
- 文件格式必须严格如下（时间保留两位小数，四元数保留7位小数，且要求归一化和 $\left.q_{w} \geq 0\right)$ ：

| t | x y | z | w |
| :--- | :--- | :--- | :--- |
| 0.00 | 0．0499792，0， | 0， | 0.9987503 |
| 0.02 | 0．0499167， 0 |  | 0．0024979， 0.9975021 |
| 0.04 | 0．0523491， | 0．0523491， | 0.9961306 |

## 提交方式：

1．把计算思路和最终的四元数变化图展示在报告中，力求简洁清晰为主。
2．quadrotor_df 这个ROS包放在 code/src路径下一起提交。
3．把最终得到的 df_quaternion．csv 放到 solutions 的文件夹中提交。

