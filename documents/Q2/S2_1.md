### 1\. A\* 轨迹规划的启发式与 Tie-Breaker

在 A\* 算法中，总代价 $f(n) = g(n) + h(n)$。

  * $g(n)$：从起点到当前点的实际代价。
  * $h(n)$：从当前点到终点的估计代价（启发式）。

#### 1.1 Tie-Breaker 的作用

**代码中的 Tie-Breaker** 通常是指在计算欧几里得距离（Euclidean Distance）作为启发式 $h(n)$ 后，乘上一个略大于 1 的系数 $p$（例如 $1.0 + 1/10000$）。即 $h^*(n) = h(n) \times (1 + p)$。

  * **对开集（Open Set）拓展顺序的影响**：

      * **打破对称性**：在栅格地图中，往往存在多条路径具有相同的 $f$ 值（例如在空旷区域，先走横向再走纵向，和先走纵向再走横向，其 $f$ 值理论上一样）。这会导致 A\* 像 Dijkstra 一样搜索大量等价节点，效率低下。
      * **倾向性（Greediness）**：引入 Tie-Breaker 后，打破了 $f$ 值的平衡。它会轻微地增加 $h$ 的权重，使算法倾向于选择**更靠近终点**（$h$ 更小）的节点进行拓展，而不是拓展那些虽然 $g$ 很小但离终点还远的节点。这使得搜索形态更像“深度优先”，从而显著**加快搜索速度**。

  * **对路径平滑性的影响**：

      * 如果不加 Tie-Breaker，A\* 可能会探索出一幅“波浪状”或非常宽的路径带。
      * 加上 Tie-Breaker 后，算法会坚定地朝着目标方向“钻”，通常会产生一条\*\*“走之”字形（Zigzag）\*\*但紧贴对角线的路径。虽然它在微观上看起来有很多折线（不平滑），但它避免了路径在无关区域的冗余扩展。

#### 1.2 如何让无人机偏好平面飞行（减少高度变化）

要让无人机倾向于在同一高度飞行（Penalty on Z-axis），好的做法是**修改边权（Edge Cost）**，即修改 $g(n)$ 的计算方式，而不是仅仅修改启发式 $h(n)$。

**修改方案**：
在代码的 `AstarGetSucc` 函数中，计算邻居节点的 `edgeCostSets` 时，对 Z 轴的变化施加惩罚系数。

```cpp
// 伪代码示例
double move_cost = sqrt(dx*dx + dy*dy + dz*dz);
if (dz != 0) {
    move_cost *= penalty_factor; // penalty_factor > 1.0，例如 2.0
}
edgeCostSets.push_back(move_cost);
```

**对可行性与最优性的影响**：

  * **可行性（Feasibility）**：**不受影响**。A\* 依然能找到路径。只要惩罚系数不是无穷大，当平面路径被障碍物完全堵死时，算法为了到达终点，依然会选择“支付”高昂的代价去改变高度。无人机不会因为偏好平面而被困死。
  * **最优性（Optimality）**：
      * **欧几里得空间的最优性丧失**：算法找到的将不再是三维空间中几何距离最短的路径。
      * **加权代价的最优性保持**：算法找到的是在**新定义的代价函数**（距离 + 高度惩罚）下的最优路径。这正是我们想要的——在电量消耗或控制稳定性层面可能是更“优”的。

-----

### 2\. Path Simplify (Douglas-Peucker) 与路径分辨率

`pathSimplify` 使用的是递归的 Ramer-Douglas-Peucker (RDP) 算法。它将一系列密集的栅格点简化为稀疏的关键航点（Waypoints）。`path_resolution` 是该算法的阈值（$\epsilon$），决定了点到直线的最大允许偏差。

结合无人机动力学（加速度限制、姿态响应时间），`path_resolution` 的选择至关重要：

#### 2.1 path\_resolution 过大（\> 障碍物间隙或机身尺寸）

  * **安全性问题（碰撞风险）**：
      * **切角过大**：RDP 算法会把一条绕过障碍物的折线简化为直线。如果分辨率过大，简化后的直线可能会**直接穿过障碍物的边缘**（原来的路径是贴着障碍物走的，简化后的直线“切”进了障碍物）。
      * (示意图：原始路径绕过圆形障碍，简化路径直接穿过圆形)
  * **跟踪误差（Overshoot）**：
      * 分辨率大意味着航点稀疏，路径段很长。无人机在长直线段上会加速到较高速度。
      * 当到达下一个航点需要急转弯（例如 90 度）时，由于**加速度约束**，无人机无法瞬间改变速度矢量。这会导致严重的**过冲（Overshoot）**，偏离规划路径，不仅增加跟踪误差，还可能撞上路径外侧的障碍物。

#### 2.2 path\_resolution 过小（接近栅格分辨率）

  * **安全性问题（抖动）**：
      * 路径会保留大量原始栅格路径的“锯齿”或“阶梯”形状。
      * 无人机的控制器在试图跟踪这些密集且频繁转向的微小线段时，会频繁地加减速和调整姿态（高频控制输入）。这会导致机身**剧烈抖动（Oscillation）**，可能诱发控制系统的不稳定。
  * **跟踪误差（效率低下）**：
      * **速度受限**：由于航点间距太短，无人机刚开始加速就到了下一个点需要减速或转向，导致无人机始终**无法达到期望的巡航速度**，飞行效率极低。
      * **执行与规划不符**：实际上，由于底层控制器的滤波作用，无人机根本走不出那些微小的锯齿，而是走了一条“平均”出来的轨迹，这使得保留这些点不仅没有意义，还浪费了算力。